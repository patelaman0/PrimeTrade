<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>User Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        height: 100vh;
        display: flex;
        background-color: #0f141a;
        color: #e1e1e1;
    }
    #sidebar {
        width: 250px;
        background-color: #1b1f27;
        height: 100vh;
        position: fixed;
        padding-top: 2rem;
        box-shadow: 2px 0 12px rgba(0,0,0,0.6);
    }
    #sidebar .nav-link {
        color: #e1e1e1;
        font-weight: 500;
        padding: 0.8rem 1.5rem;
        margin: 0.2rem 0;
        border-radius: 0.5rem;
        transition: all 0.2s;
    }
    #sidebar .nav-link:hover { background-color: #2a2f3b; color: #ffffff; }
    #sidebar .nav-link.active { background: linear-gradient(90deg, #4fc3f7, #0288d1); color: #0f141a; }
    .navbar-brand { font-size: 1.5rem; font-weight: 700; text-align: center; margin-bottom: 2rem; display: block; color: #4fc3f7; }
    #main-content { margin-left: 250px; padding: 2rem; width: 100%; overflow-y: auto; }
    .card { margin-bottom: 1.5rem; border-radius: 1rem; background-color: #1f242e; color: #e1e1e1; border: none; box-shadow: 0 6px 18px rgba(0,0,0,0.4); }
    .card-header { font-weight: 700; font-size: 1.2rem; background: linear-gradient(90deg, #4fc3f7, #0288d1); color: #0f141a; border-radius: 1rem 1rem 0 0; }
    .btn-primary { background-color: #4fc3f7; border: none; color: #0f141a; font-weight: 500; }
    .btn-primary:hover { background-color: #29b6f6; }
    .btn-success { background-color: #26a69a; border: none; font-weight: 500; }
    .btn-success:hover { background-color: #00bfa5; }
    .btn-danger { background-color: #f44336; border: none; font-weight: 500; }
    .btn-danger:hover { background-color: #e57373; }
    textarea.form-control { background-color: #0f1a33; border: none; border-radius: 0.5rem; color: #e1e1e1; }
    textarea.form-control::placeholder { color: #8da3c3; }
    table { color: #e1e1e1; }
    th { color: #4fc3f7; }
  </style>
</head>
<body>

<!-- Sidebar -->
<div id="sidebar">
  <div class="navbar-brand">User Dashboard</div>
  <ul class="nav flex-column">
    <li class="nav-item">
      <a class="nav-link active" href="#" onclick="showSection('viewThoughts', this)">Trending Shares</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="showSection('shareThoughts', this)">Share Your Topics</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="showSection('profileUpdate', this)">Update Profile</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="showSection('deleteProfile', this)">Delete Profile</a>
    </li>
    <li class="nav-item mt-3">
      <a class="nav-link text-danger" th:href="@{/logout}">Logout</a>
    </li>
  </ul>
</div>

<!-- Main content -->
<div id="main-content">
  <h2>Welcome, <span th:text="${user.name}">User</span>!</h2>
  <p>Manage your profile and shares using the menu.</p>

  <!-- View Thoughts -->
  <div id="viewThoughts" class="section">
    <div class="section-header mb-4">
      <h2 style="color:#ffffff; font-weight:700;">Your Shares</h2>
    </div>

    <!-- Messages -->

    <!-- No shares -->
    <div th:if="${#lists.isEmpty(shares)}" style="color:#b0b0b0; margin-bottom:1rem;">
      <p>No shares yet. Start sharing your thoughts!</p>
    </div>

    <!-- Shares grid -->
    <div class="shares-grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:1.5rem;">
      <div th:each="s : ${shares}"
           style="background: rgba(31,36,46,0.75);
                backdrop-filter: blur(12px) saturate(150%);
                border-radius: 1rem;
                padding:1.5rem;
                box-shadow: 0 10px 25px rgba(0,0,0,0.3);
                color:#e1e1e1;
                display:flex;
                flex-direction:column;
                justify-content:space-between;
                transition: transform 0.2s ease, box-shadow 0.2s ease;">

        <!-- Card content -->
        <div>
          <h3 style="margin:0 0 0.5rem 0; font-weight:700; color:#ffffff; font-size:1.25rem;" th:text="${s.shareName}">Share Title</h3>
          <h5 style="margin:0 0 0.75rem 0; color:#b0b0b0; font-weight:500; font-size:0.95rem;" th:text="${s.username}">Username</h5>
          <p style="margin:0; color:#c1c1c1; font-size:0.9rem; line-height:1.4;" th:text="${s.shareDescription}">Share description...</p>
        </div>


      </div>
    </div>
  </div>

  <!-- Hover effect -->
  <style>
    .shares-grid > div:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.35);
    }
  </style>



  <!-- Share Thoughts -->
  <div id="shareThoughts" class="section" style="display:none;">
    <div class="card">
      <div class="card-header">Share Thoughts</div>

      <!-- Success / Error Messages -->
      <div th:if="${sharesMessage}" class="alert alert-success" th:text="${sharesMessage}"></div>
      <div th:if="${sharesError}" class="alert alert-danger" th:text="${sharesError}"></div>

      <div class="card-body">
        <!-- Share Form -->
        <form th:action="@{/user/shares/add}" method="post">
          <div class="mb-3">
            <label for="shareName" class="form-label">Shares Name</label>
            <input type="text" class="form-control" id="shareName" name="shareName" placeholder="Enter title" required>
          </div>
          <div class="mb-3">
            <label for="shareDescription" class="form-label">Description</label>
            <textarea class="form-control" id="shareDescription" name="shareDescription" rows="4" placeholder="Write something..." required></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Post</button>
        </form>

        <!-- User Posts Table -->
        <div class="mt-4">
          <h5>Your Posts</h5>
          <table class="table table-bordered">
            <thead>
            <tr>
              <th>Title</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <!-- Loop only user's posts -->
            <tr th:each="share : ${userShares}">
              <td th:text="${share.shareName}">Post Title</td>
              <td th:text="${share.shareDescription}">Post Description</td>
              <td>

                <form th:action="@{'/user/shares/delete/' + ${share.id}}" method="post" style="display:inline">
                  <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure?')">Delete</button>
                </form>
              </td>
            </tr>
            <!-- Message if no posts -->
            <tr th:if="${#lists.isEmpty(userShares)}">
              <td colspan="3" class="text-center">You have not posted anything yet.</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>


  <!-- Profile Update -->
  <div id="profileUpdate" class="section" style="display:none;">
    <div class="card">
      <div class="card-header">Update Profile</div>
      <div class="card-body">
        <div th:if="${profileMessage}" class="alert alert-success" th:text="${profileMessage}"></div>
        <div th:if="${profileError}" class="alert alert-danger" th:text="${profileError}"></div>

        <form th:action="@{/user/profile/update}" method="post">
          <div class="mb-3">
            <label for="updateName" class="form-label">Name</label>
            <input type="text" class="form-control" id="updateName" name="fullName" th:value="${user.name}">
          </div>
          <div class="mb-3">
            <label for="updateEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="updateEmail" name="emailId" th:value="${user.email}" readonly>
          </div>
          <div class="mb-3">
            <label for="updatePassword" class="form-label">New Password</label>
            <input type="password" class="form-control" id="updatePassword" name="password" placeholder="Leave blank if no change">
          </div>
          <button type="submit" class="btn btn-success">Update Profile</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Profile -->
  <div id="deleteProfile" class="section" style="display:none;">
    <div class="card">
      <div class="card-header text-danger">Delete Profile</div>
      <div class="card-body">
        <p>Be careful! This action cannot be undone.</p>
        <form th:action="@{/user/profile/delete}" method="post">
          <button class="btn btn-danger">Delete Profile</button>
        </form>
      </div>
    </div>
  </div>

</div>

<script>
  function showSection(sectionId, el) {
      document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
      document.getElementById(sectionId).style.display = 'block';
      document.querySelectorAll('#sidebar .nav-link').forEach(link => link.classList.remove('active'));
      if (el) el.classList.add('active');
  }

  document.addEventListener("DOMContentLoaded", () => {
      // Show View Thoughts section by default
      showSection('viewThoughts', document.querySelector('#sidebar .nav-link.active'));
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
