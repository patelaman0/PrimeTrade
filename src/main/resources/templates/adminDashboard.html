<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body{
        margin:0;
        background:#0b0f19;
        font-family:'Segoe UI',sans-serif;
        color:#e5e7eb;
    }

    /* SIDEBAR */
    .sidebar{
        width:260px;
        height:100vh;
        position:fixed;
        background:linear-gradient(180deg,#111827,#020617);
        padding:25px;
    }
    .sidebar h3{
        text-align:center;
        background:linear-gradient(90deg,#f59e0b,#fbbf24);
        -webkit-background-clip:text;
        color:transparent;
    }
    .sidebar a{
        display:flex;
        align-items:center;
        gap:10px;
        padding:12px;
        margin-top:8px;
        color:#cbd5f5;
        border-radius:10px;
        text-decoration:none;
    }
    .sidebar a:hover,
    .sidebar a.active{
        background:#1f2937;
        color:#fff;
    }

    /* MAIN */
    .main{
        margin-left:260px;
        padding:30px;
    }
    .card{
        background:#1f2937;
        border:none;
        border-radius:15px;
        margin-bottom:25px;
    }
    .card-header{
        background:#020617;
        color:#fbbf24;
        font-weight:600;
    }
    .section{ display:none; }
  </style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <h3>Prime Trade</h3>
  <hr>

  <a href="#" class="nav-link active" onclick="showSection('feedback', this)">
    <i class="bi bi-chat-left-text"></i> Feedback
  </a>
  <a href="#" class="nav-link" onclick="showSection('users', this)">
    <i class="bi bi-people"></i> Users
  </a>
  <a href="#" class="nav-link" onclick="showSection('createAdmin', this)">
    <i class="bi bi-person-plus"></i> Create Admin
  </a>
  <a href="#" class="nav-link" onclick="showSection('profiles', this)">
    <i class="bi bi-gear"></i> Update Profile
  </a>
  <a href="#" class="nav-link text-danger" onclick="showSection('delete', this)">
    <i class="bi bi-trash"></i> Delete Profile
  </a>

  <hr>
  <a th:href="@{/logout}" class="nav-link text-danger">
    <i class="bi bi-box-arrow-right"></i> Logout
  </a>
</div>

<!-- MAIN -->
<div class="main">

  <h4>Welcome, <span th:text="${adminName}">Admin</span> ðŸ‘‹</h4>

  <!-- GLOBAL ALERTS -->
  <div th:if="${successMessage}" class="alert alert-success" id="successAlert">
    <span th:text="${successMessage}"></span>
  </div>
  <div th:if="${errorMessage}" class="alert alert-danger" id="errorAlert">
    <span th:text="${errorMessage}"></span>
  </div>

  <!-- FEEDBACK -->
  <div id="feedback" class="section">
    <div class="card">
      <div class="card-header">Feedback</div>
      <div class="card-body">
        <table class="table table-dark">
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Message</th>
            <th>Action</th>
          </tr>
          <tr th:each="f : ${feedbackList}">
            <td th:text="${f.fullName}"></td>
            <td th:text="${f.email}"></td>
            <td th:text="${f.message}"></td>
            <td>
              <form th:action="@{/admin/dashboard/feedback/{id}/delete(id=${f.id})}" method="post">
                <button class="btn btn-danger btn-sm">Delete</button>
              </form>
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>


  <!-- USERS -->
  <div id="users" class="section">
    <div class="card">
      <div class="card-header">Users</div>
      <div class="card-body">
        <table class="table table-dark">
          <tr>
            <th>Name</th><th>Email</th><th>Role</th><th>Action</th>
          </tr>
          <tr th:each="u : ${userList}">
            <td th:text="${u.name}"></td>
            <td th:text="${u.email}"></td>
            <td th:text="${u.roles[0]}"></td> <!-- Fixed role display -->
            <td>
              <form th:action="@{/admin/users/{id}(id=${u.id.toString()})}" method="post">
                <button class="btn btn-danger btn-sm">Delete</button>
              </form>
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <!-- CREATE ADMIN -->
  <div id="createAdmin" class="section">
    <div class="card">
      <div class="card-header">Create Admin</div>
      <div class="card-body">
        <form th:action="@{/admin/add}" method="post">
          <input class="form-control mb-3" name="name" placeholder="Name">
          <input class="form-control mb-3" name="email" placeholder="Email">
          <input class="form-control mb-3" type="password" name="password" placeholder="Password">
          <button class="btn btn-warning">Create</button>
        </form>
      </div>
    </div>
  </div>

  <!-- UPDATE PROFILE -->
  <div id="profiles" class="section">
    <div class="card">
      <div class="card-header">Update Profile</div>
      <div class="card-body">
        <form th:action="@{/admin/profiles/update}" method="post">
          <input class="form-control mb-3" name="fullName" th:value="${user.name}" placeholder="Full Name">
          <input class="form-control mb-3" name="emailId" th:value="${user.email}" placeholder="Email" readonly>
          <input class="form-control mb-3" type="password" name="password" placeholder="New Password">
          <button class="btn btn-success">Update</button>
        </form>
      </div>
    </div>
  </div>

  <!-- DELETE PROFILE -->
  <div id="delete" class="section">
    <div class="card">
      <div class="card-header text-danger">Delete Profile</div>
      <div class="card-body">
        <form th:action="@{/admin/profiles/delete}" method="post">
          <p class="text-danger">This action cannot be undone</p>
          <button class="btn btn-danger">Delete Account</button>
        </form>
      </div>
    </div>
  </div>

</div>

<script>
  function showSection(id, el){
      document.querySelectorAll('.section').forEach(s => s.style.display='none');
      document.getElementById(id).style.display='block';

      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      el.classList.add('active');
  }

  document.addEventListener("DOMContentLoaded", () => {
      // show default section
      showSection('feedback', document.querySelector('.nav-link.active'));

      // auto remove alerts after 3s
      setTimeout(() => {
          document.getElementById("successAlert")?.remove();
          document.getElementById("errorAlert")?.remove();
      }, 3000);
  });
</script>

</body>
</html>
